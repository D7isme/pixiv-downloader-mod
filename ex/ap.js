var XEnPGic=function(){function h(a){var b=a.imgData;a=b.indexOf("base64,");if(0>a)throw Error("invalid image url");b=atob(b.substring(a+7));var d=new Uint8Array(b.length);for(a=0;a<b.length;a++)d[a]=b.charCodeAt(a)&255;return d}function r(a){var b="";a.forEach(function(d){for(var c=0;c<d.length;c++)b+=String.fromCharCode(d[c])});return"data:image/png;base64,"+btoa(b)}function t(a){if(137!=a[0]||80!=a[1]||78!=a[2]||71!=a[3]||13!=a[4]||10!=a[5]||26!=a[6]||10!=a[7])throw Error("invalid png header");
for(var b=8,d=[];b<a.length;){var c={};c.offset=b;c.dataLength=(a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3])>>>0;b+=4;c.type=String.fromCharCode(a[b],a[b+1],a[b+2],a[b+3]);b+=4;c.dataOffset=b;c.data=a.subarray(b,c.dataLength+b);b+=c.dataLength;c.crc=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3];b+=4;c.length=b-c.offset;c.fragment=a.subarray(c.offset,b);d.push(c);if("IEND"===c.type)break}return d}function f(a){return[a>>24&255,a>>16&255,a>>8&255,a&255]}function k(a,b){for(var d=0,c=1;c<arguments.length;c++)d+=arguments[c].length;
var e=new Uint8Array(d+12);e[0]=d>>24&255;e[1]=d>>16&255;e[2]=d>>8&255;e[3]=d&255;e[4]=a.charCodeAt(0)&255;e[5]=a.charCodeAt(1)&255;e[6]=a.charCodeAt(2)&255;e[7]=a.charCodeAt(3)&255;d=8;for(c=1;c<arguments.length;c++)for(var g=0;g<arguments[c].length;g++)e[d++]=arguments[c][g];c=-1;for(g=4;g<d;g++)c=c>>>8^n[(c^e[g])&255];c^=-1;e[d]=c>>24&255;e[d+1]=c>>16&255;e[d+2]=c>>8&255;e[d+3]=c&255;return e}function p(){this.frames=[]}for(var n=new Int32Array(256),m=0;256>m;m++){for(var l=m,q=0;8>q;q++)l=l&1?
3988292384^l>>1&2147483647:l>>1&2147483647;n[m]=l}p.prototype={addFrame:function(a,b){var d={};d.data=h(b);d.index=t(d.data);d.idats=d.index.filter(function(c){return"IDAT"===c.type});d.delay=a;d.width=b.width;d.height=b.height;this.frames.push(d)},toDataURL:function(){if(0===this.frames.length)throw Error("no frames");if(1===this.frames.length)return r([this.frames.data]);var a=[],b=this.frames[0],d=b.idats[0];if(!d)throw Error("cannot find IDAT");a.push(b.data.subarray(0,d.offset));a.push(k("acTL",
f(this.frames.length),f(0)));d=b.delay;var c=0;a.push(k("fcTL",f(c++),f(b.width),f(b.height),f(0),f(0),[d>>8&255,d&255,3,232],[1,0]));b.idats.forEach(function(g){a.push(g.fragment)});for(b=1;b<this.frames.length;b++){var e=this.frames[b];d=e.delay;a.push(k("fcTL",f(c++),f(e.width),f(e.height),f(0),f(0),[d>>8&255,d&255,3,232],[1,0]));e.idats.forEach(function(g){a.push(k("fdAT",f(c++),g.data))})}a.push(k("IEND"));return new Blob(a,{type:"image/png"})}};return p}(),percent=0,frameCnt=0,delaySum=0,encoder=
new XEnPGic;onmessage=function(h){h=h.data;"frameAdd"===h.cmd?(encoder.addFrame(h.delay,h),postMessage({cmd:"percent",percent:++percent})):"finish"===h.cmd&&(h=encoder.toDataURL(),postMessage({cmd:"finish",byteArray:h}))};
